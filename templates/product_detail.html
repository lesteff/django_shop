{% extends "base.html" %}
{% load static %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-5">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
        <div class="mb-3 text-center">
            {% with main_image=product.get_main_image %}
                {% if main_image %}
                    <img src="{{ main_image.url }}"
                         class="img-fluid rounded shadow-sm"
                         alt="{{ product.name }}"
                         style="height: 300px; object-fit: cover; max-width: 100%;">
                {% else %}
                    <img src="{% static 'no-image.png' %}"
                         class="img-fluid rounded shadow-sm"
                         alt="–ù–µ—Ç —Ñ–æ—Ç–æ"
                         style="height: 300px; object-fit: cover; max-width: 100%;">
                {% endif %}
            {% endwith %}
        </div>

        <!-- –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
        <div class="row">
            {% for img_data in product.get_images_with_fallback %}
            <div class="col-3 mb-2 text-center">
                {% if img_data.is_real %}
                    <div class="position-relative">
                        <img src="{{ img_data.image.url }}"
                             class="img-thumbnail {% if img_data.is_main %}border-success border-2{% else %}border-secondary{% endif %}"
                             alt="{{ product.name }}"
                             style="height: 80px; object-fit: cover; width: 100%;">
                        {% if img_data.is_main %}
                        <span class="position-absolute top-0 start-50 translate-middle badge bg-success">
                            ‚òÖ
                        </span>
                        {% endif %}
                    </div>
                {% else %}
                    <img src="{% static 'no-image.png' %}"
                         class="img-thumbnail border-light"
                         alt="–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
                         style="height: 80px; object-fit: cover; width: 100%; opacity: 0.4;">
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–ª–∞–≤–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ -->
        <div class="mt-3 text-center">
            <small class="text-muted">
                ‚òÖ - –≥–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
            </small>
        </div>
    </div>

    <div class="col-md-7">
        <h2 class="mb-3">{{ product.name }}</h2>

        <!-- –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
        <div class="card mb-4 border-0 bg-light">
            <div class="card-body">
                <h5 class="card-title text-primary">üìã –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h5>
                <hr>
                <p class="card-text fs-6">{{ product.description|linebreaks }}</p>
            </div>
        </div>

        <!-- –¶–µ–Ω–∞ –∏ –Ω–∞–ª–∏—á–∏–µ -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col">
                        <h4 class="text-success mb-0">{{ product.price }} —Ä—É–±.</h4>
                    </div>
                    <div class="col-auto">
                        {% if product.in_stock %}
                            <span class="badge bg-success fs-6 p-2">‚úÖ –í –Ω–∞–ª–∏—á–∏–∏</span>
                        {% else %}
                            <span class="badge bg-danger fs-6 p-2">‚ùå –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô - –≠–¢–û–¢ –ë–õ–û–ö –î–û–õ–ñ–ï–ù –ë–´–¢–¨ -->
        <div class="d-grid gap-2">
            {% if product.in_stock %}
            <form method="post" action="{% url 'add_to_cart' product.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-success btn-lg py-3">
                    üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                </button>
            </form>
            {% else %}
            <button class="btn btn-secondary btn-lg py-3" disabled>
                ‚ö†Ô∏è –¢–æ–≤–∞—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
            </button>
            {% endif %}

            <a href="{% url 'products' %}" class="btn btn-outline-primary">
                ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞—Ç–∞–ª–æ–≥—É —Ç–æ–≤–∞—Ä–æ–≤
            </a>

            <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ—Ä–∑–∏–Ω—É -->
            <a href="{% url 'cart_view' %}" class="btn btn-outline-warning">
                üõí –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
            </a>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        {% if product.category %}
        <div class="mt-4 pt-3 border-top">
            <p class="text-muted mb-1">
                <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong>
                <a href="{% url 'products' %}?category={{ product.category.id }}" class="text-decoration-none">
                    {{ product.category.name }}
                </a>
            </p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}